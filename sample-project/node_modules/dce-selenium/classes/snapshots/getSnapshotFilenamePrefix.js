const path = require('path');
const shell = require('shelljs');

// Keep track of snapshots
const snapshotIndices = {};
const getSnapshotIndex = () => {
  if (!snapshotIndices[global.testTitle]) {
    snapshotIndices[global.testTitle] = 0;
  }
  snapshotIndices[global.testTitle] += 1;
  return snapshotIndices[global.testTitle];
};

// Get current working directory
const currentDir = process.env.PWD;

module.exports = (suffix) => {
  const folder = (
    global.describeFolder
      ? path.join(
        currentDir,
        'test',
        'snapshots',
        global.dceSeleniumConfig.snapshotName,
        global.dceSeleniumConfig.browserDescription,
        global.describeFolder,
        global.testTitle
      )
      : path.join(
        currentDir,
        'test',
        'snapshots',
        global.dceSeleniumConfig.snapshotName,
        global.dceSeleniumConfig.browserDescription,
        global.testTitle
      )
  );

  // Create folder
  if (!global.dceSeleniumConfig.noSnapshots) {
    shell.mkdir('-p', folder);
  }

  const snapshotIndex = getSnapshotIndex();
  return path.join(folder, `${snapshotIndex} - ${global.actionTitle || 'unnamed action'}${suffix ? '-' + suffix : ''}`);
};
